<!DOCTYPE html>

<!-- Copyright (c) 2014, the Dart project authors.  Please see the AUTHORS file
     for details. All rights reserved. Use of this source code is governed by a
     BSD-style license that can be found in the LICENSE file. -->

<html>
  <head>
  	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title></title>
    <!--<link href='https://fonts.googleapis.com/css?family=Roboto'
        rel='stylesheet' type='text/css'> -->
    <style>
      body {
        color: #ddd;
        font-size: 12pt;
        margin: 0;
        padding: 0;
      }

      h2 {
        margin-top: 0;
      }
    </style>
    <script src="https://storage.cloud.google.com/compilation_artifacts/require.js"></script>
    <script>

// Polyfill from https://developer.mozilla.org/en-US/docs/Web/API/Element/toggleAttribute#Polyfill
if (!Element.prototype.toggleAttribute) {
  Element.prototype.toggleAttribute = function(name, force) {
    if(force !== void 0) force = !!force 
    
    if (this.getAttribute(name) !== null) {
      if (force) return true;
      
      this.removeAttribute(name);
      return false;
    } else {
      if (force === false) return false;
      
      this.setAttribute(name, "");
      return true;
    }
  };
}


replaceJavaScript = function(value) {
  // Remove the old node.
  var oldNode = document.getElementById('compiledJsScript');
  if (oldNode && oldNode.parentNode) {
    oldNode.parentNode.removeChild(oldNode);
  }

  // Create a new node.
  var scriptNode = document.createElement('script');
  scriptNode.setAttribute('id', 'compiledJsScript');
  scriptNode.toggleAttribute('defer');
  scriptNode.text = value;
  document.head.appendChild(scriptNode);
};

messageHandler = function(e) {
  var obj = e.data;
  var command = obj.command;
  var body = document.body;

  if (command === 'setCss') {
    document.getElementById('styleId').innerHTML = obj.css;
  } else if (command === 'setHtml') {
    body.innerHTML = obj.html;
  } else if (command === 'execute') {
    // Replace all three.
    body.innerHTML = obj.html;
    document.getElementById('styleId').innerHTML = obj.css;
    setTimeout(function () {
      replaceJavaScript(obj.js);
    }, 150);
  }
};

window.setTimeout(function () {
  window.addEventListener('message', messageHandler, false);
  parent.postMessage({'sender': 'frame', 'type': 'ready'}, '*');
}, 50);
    </script>

    <style id="styleId"></style>
    <script id="compiledJsScript" defer></script>
  </head>

  <body>
  </body>
</html>
